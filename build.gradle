apply plugin: "cpp"

// The cpp plugin is required so tahat the assemble task can be set to depend on the OS appropriate google test build task

task wrapper(type: Wrapper) {
    gradleVersion = '2.4'
}

task buildGoogleTestMac(type: Exec) {
    commandLine './buildGoogleTestMac.sh'
}

task buildGoogleTest(type: Exec) {
    commandLine './buildGoogleTest.sh'
}

task buildFullJar(dependsOn: ':krypto-api:GenerateJniHeaders') {
	// depends on generating headers
	// run build lib
	tasks.getByPath(':krypto-lib:build').execute()
	// move libs
	exec {
        commandLine "cp", "krypto-lib/build/binaries/mainSharedLibrary/release/*", "krypto-api/src/main/resources/"
    }
	// run jar api
	tasks.getByPath(':krypto-api:jar').execute()
}

//Determine OS 
//TODO: Add Windows support.
def osname = System.properties['os.name'].toLowerCase().toLowerCase()

if (osname.contains('windows')) {
    print "Too close for missiles switching to guns."
} else if (osname.contains('mac') ) {
    print "build for mac"
    assemble.dependsOn buildGoogleTestMac
} else {
    print "Building for linux."
    assemble.dependsOn buildGoogleTest
}
